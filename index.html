<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>觀眾入口</title>
  <style>
    body { font-family: 微軟正黑體; text-align:center; padding:50px; }
    h1 { color: #2a52be; }
    p { font-size: 1.2em; }
    button { padding: 10px 20px; font-size: 1em; cursor:pointer; }
    #waitingScreen { display:none; } /* 一開始隱藏等待區 */
  </style>
</head>
<body>
  <!-- 初始歡迎畫面 -->
  <div id="joinScreen">
    <h1>歡迎參加體驗</h1>
    <p>請按「參加抽籤」加入候選人名單。</p>
    <button id="joinBtn">參加抽籤</button>
  </div>

  <!-- 等待區畫面（隱藏） -->
  <div id="waitingScreen">
    <h1>等待區</h1>
    <p>你已成功加入候選人名單，請稍候 Admin 抽籤...</p>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <script>
    // 初始化 Firebase
    var firebaseConfig = {
      apiKey: "AIzaSyBBnbx00_d0Py6px-b_uZVrgpSapHNLiBo",
      authDomain: "lottery-test-b0021.firebaseapp.com",
      databaseURL: "https://lottery-test-b0021-default-rtdb.firebaseio.com",
      projectId: "lottery-test-b0021",
      storageBucket: "lottery-test-b0021.firebasestorage.app",
      messagingSenderId: "226750767626",
      appId: "1:226750767626:web:95bcb340e42cb0703575f3"
    };
    firebase.initializeApp(firebaseConfig);

    // 生成唯一 userId
    var userId = localStorage.getItem('userId');
    if (!userId) {
      userId = 'user-' + Math.floor(Math.random()*1000000);
      localStorage.setItem('userId', userId);
    }

    // 參加抽籤按鈕
    document.getElementById('joinBtn').addEventListener('click', () => {
      firebase.database().ref('participants/' + userId).update({
        status: 'ready',
        joined: true,
        timestamp: Date.now()
      }).then(() => {
        // 隱藏 joinScreen
        document.getElementById('joinScreen').style.display = 'none';
        // 顯示 waitingScreen
        document.getElementById('waitingScreen').style.display = 'block';
      });
    });

    // 監聽自己的 status
    firebase.database().ref('participants/' + userId + '/status').on('value', snapshot => {
      const status = snapshot.val();
      if (status === 'onStage') window.location.href = 'stage.html';
      else if (status === 'audience') window.location.href = 'audience.html';
    });

    // 監聽 currentPage，統一跳頁
    firebase.database().ref('currentPage').on('value', snapshot => {
      const page = snapshot.val();
      if (!page) return;
      window.location.href = page + '.html';
    });
  </script>
</body>
</html>