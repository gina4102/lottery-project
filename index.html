<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>觀眾入口</title>
</head>
<body>
  <h1>歡迎參加體驗</h1>
  <p>請按「參加抽籤」加入候選人名單。</p>
  <button id="joinBtn">參加抽籤</button>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <script>
    // 初始化 Firebase
    var firebaseConfig = {
      apiKey: "你的 apiKey",
      authDomain: "你的 authDomain",
      databaseURL: "你的 databaseURL",
      projectId: "你的 projectId",
      storageBucket: "你的 storageBucket",
      messagingSenderId: "你的 messagingSenderId",
      appId: "你的 appId"
    };
    firebase.initializeApp(firebaseConfig);

    // 生成唯一 userId
    var userId = localStorage.getItem('userId');
    if (!userId) {
      userId = 'user-' + Math.floor(Math.random()*1000000);
      localStorage.setItem('userId', userId);
    }

    // 參加抽籤按鈕
    document.getElementById('joinBtn').addEventListener('click', () => {
      firebase.database().ref('participants/' + userId).update({
        status: 'ready',
        joined: true,
        timestamp: Date.now()
      });
      alert("你已加入抽籤！");
    });

    // 監聽自己的 status
    firebase.database().ref('participants/' + userId + '/status').on('value', snapshot => {
      const status = snapshot.val();
      if (status === 'onStage') window.location.href = 'stage.html';
      else if (status === 'audience') window.location.href = 'audience.html';
    });

    // 監聽 currentPage，統一跳頁
    firebase.database().ref('currentPage').on('value', snapshot => {
      const page = snapshot.val();
      if (!page) return;
      window.location.href = page + '.html';
    });
  </script>
</body>
</html>
